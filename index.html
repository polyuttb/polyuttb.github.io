<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:og="http://ogp.me/ns#">

<head>
  <meta charset="UTF-8">
  <title>PolyU TimeTableBuilder v1.6.1</title>
  
  <!-- Internet Explorer Compatibility -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  <!-- Canonical URL -->
  <link rel="canonical" href="https://polyuttb.github.io/" />
  
  <!-- Author, Description, Keywords for SEO -->
  <meta name="author" content="CY Fung">
  <meta name="description" content="A webtool for creating beautiful PolyU timetable." />
  <meta name="keywords" content="polyu, timetable, timetablebuilder">
  
  <!-- Robots -->
  <meta name="robots" content="index, follow">

  <!-- Favicon -->
<!-- Standard favicon -->
  <link rel="icon" type="image/x-icon" href="/images/favicon.ico">

  <!-- Recommended favicon sizes for different devices -->
  <link rel="icon" sizes="16x16" type="image/png" href="/images/favicon-16.png">
  <link rel="icon" sizes="32x32" type="image/png" href="/images/favicon-32.png">
  <link rel="icon" sizes="48x48" type="image/png" href="/images/favicon-48.png">

  <!-- For iOS web apps. -->
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

  <!-- Open Graph Tags for Social Media -->
  <meta property="og:title" content="PolyU TimeTableBuilder" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://polyuttb.github.io/" />
  <meta property="og:image" itemprop="image" content="https://polyuttb.github.io/images/banner-v2-d.png" />
  <meta property="og:description" content="A webtool for creating beautiful PolyU timetable. Follow facebook page for updates." />

  <!-- Twitter Cards -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="PolyU TimeTableBuilder" />
  <meta name="twitter:description" content="A webtool for creating beautiful PolyU timetable. Follow facebook page for updates." />
  <meta name="twitter:image" content="https://polyuttb.github.io/images/banner-v2-d.png" />

  <!-- External Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/blissfuljs@1.0.6/bliss.shy.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/cyfung1031/jqDim@3.7.2/release/jqDim-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/js-md5@0.8.3/src/md5.min.js"></script> <!-- https://github.com/emn178/js-md5 -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script> <!-- https://github.com/niklasvh/html2canvas -->
  <script src="color-conversion-algorithms.js"></script> <!-- https://gist.github.com/mjackson/5311256 -->

  <!-- Stylesheets -->
  <link media="all" rel="stylesheet" type="text/css" href="page-v1.6.css" />
</head>

<body>
  <div class="one-page">
      <div class="menu">
          <a class="tabbut" id="but_input">Input</a>
          <a class="tabbut" id="but_output">Preview</a>
          <a class="imgdl btn disablebtn">â¬‡PNG</a>
          <div class="menuoptions">
            <div class="select-container"><select id=groupchoice></select></div><div class="select-container"><select id=gridtype></select></div><a id="optWeekNo">WeekNo</a>
            <a target="_blank" href="https://www.facebook.com/polyuttb/posts/1657914140950253" class="normallink">How to use?</a><a target="_blank" href="https://www.facebook.com/polyuttb/" class="normallink">Facebook Page</a>
            <!--<div class="fb-like" data-href="https://www.polyuttb.tk" data-width="100" data-layout="standard" data-action="like" data-size="small" data-show-faces="false" data-share="true"></div>-->
            <a target="_blank" href="https://www.polyu.edu.hk/student/" class="hotlink">eStudent</a><a target="_blank" href="https://www.polyu.edu.hk/as/subreg/easyreg/" class="hotlink removed">EasyReg (CAR&SL)</a><a target="_blank" href="https://www38.polyu.edu.hk/easyplanner/" class="hotlink">EasyPlanner</a><a target="_blank" href="https://www38.polyu.edu.hk/ePublic/subject-search.jsf" class="hotlink">ePublic</a>
          </div>
      </div>
      <div class="tab selected">
          <div class="ipt-container">
              <textarea id="ipt" class="empty"></textarea>
          </div>
      </div>
      <div class="tab">
          <div class="adaptive-outer">
              <div class="region adaptive-inner"></div>
          </div>
      </div>
  </div>
  <div id="hiddenDraw"></div>
</body>

<script>
  /* compressed by https://www.tutorialspoint.com/online_javascript_minifier.htm */
    !function () {
      const j = Bliss, O = Bliss.$; function t(e) { for (const n in e) { let t = e[n]; switch (t) { case null: break; case !1: this.removeAttribute(n); break; case !0: t = ""; default: this.setAttribute(n, t) } } } function e(t) { for (const e in t) switch (t[e]) { case !0: this.classList.add(e); break; case !1: this.classList.remove(e) } } j.setProps.sAttr = t; j.setProps.sClass = e; j.add({ sAttr: t, sClass: e, clearContent: function () { for (var t; t = this.firstChild;)this.removeChild(t) } }); const R = function () { }, d = () => null !== j(".tabbut.selected#but_output"), a = void 0 !== document.createElement("a").download, N = (R("da", a), e => new Promise(t => setTimeout(t, e))); var n = function () { const t = [10102, 10103, 10104, 10105, 10106, 10107, 10108, 10109, 10110, 10111].concat([9450, 9451, 9452, 9453, 9454, 9455, 9456, 9457, 9458, 9459, 9460]).filter(t => 9450 !== t); return [[9312, 9313, 9314, 9315, 9316, 9317, 9318, 9319, 9320, 9321, 9322, 9323, 9324, 9325, 9326].map(t => String.fromCharCode(t)), t.map(t => String.fromCharCode(t))] }(); const W = n[0], G = n[1]; function f(t, e) { function n(t) { function e(t, e) { return t[0] * e[0] + t[1] * e[1] + t[2] * e[2] } return [e(t, [.299, .587, .114]), e(t, [-.14713, -.28886, .436]), e(t, [.615, -.51499, -.10001])] } "string" == typeof t && (t = i(t)); "string" == typeof e && (e = i(e)); let r = function (e, n) { for (let t = 0; t < 3; t++)e[t] = e[t] - n[t]; return e }(n(t), n(e)); for (let t = 0; t < 3; t++)r[t] *= r[t]; return Math.sqrt(r[0] + r[1] + r[2]) } class u { clone() { let t = new u; for (var e in this) { this.hasOwnProperty(e) && (t[e] = this[e]); t[e] instanceof Array && (t[e] = t[e].slice(0)) } return t } setRGBText(t) { if ("string" == typeof t) { 3 == (t = t.replace("#", "")).length && (t = t.charAt(0) + t.charAt(0) + t.charAt(1) + t.charAt(1) + t.charAt(2) + t.charAt(2)); this.setRGB255(i(t)) } } setRGB255(t) { t instanceof Array || (t = Array.prototype.slice.call(arguments)); this.rgbArr = t; this.rgbArr[3] = 0 <= t[3] ? t[3] : 1 } setHSL(t) { if ("function" == typeof t) return this.setHSL(t(this.getHSL())); (t = (t = t instanceof Array ? t : Array.prototype.slice.call(arguments)).map(t => t))[0] /= 360; t[1] /= 100; t[2] /= 100; this.setHSL1(t) } setHSL1(t) { t instanceof Array || (t = Array.prototype.slice.call(arguments)); this.rgbArr = hslToRgb(t[0], t[1], t[2]); this.rgbArr[3] = 0 <= t[3] ? t[3] : 1 } getRGBText() { return "#" + this.rgbArr.slice(0, 3).map(t => ("0" + Math.round(t).toString(16)).substr(-2)).join("").toUpperCase() } getRGBDText() { return "rgba(" + this.rgbArr.map(t => Math.round(t)).join(", ") + ")" } getHSL1() { return rgbToHsl(this.rgbArr[0], this.rgbArr[1], this.rgbArr[2]) } getHSL() { let t = this.getHSL1(); t[0] *= 360; t[1] *= 100; t[2] *= 100; return t } invertRGB() { this.rgbArr = this.rgbArr.map(t => 255 - t) } } function i(e) { e = +("0x" + (e = e.replace("#", ""))); let n = [0, 0, 0]; for (let t = 0; t < 3; t++) { n[2 - t] = e % 256; e = (e - n[2 - t]) / 256 } return n } class _ { constructor(t) { if (t.constructor == _ && 0 <= t.val) this.val = t.val; else if ("number" == typeof t) this.val = t; else if ("object" == typeof t && 0 <= t.val) this.val = t.val; else if ("string" == typeof t) { t = 60 * +(t = t.split(":"))[0] + +t[1]; 0 <= t ? this.val = t : console.warn("Tim: invalid time format") } } getMin() { return this.val % 60 } cmp(t) { if (t && t.constructor === _) return this.val > t.val ? 1 : this.val < t.val ? -1 : this.val === t.val ? 0 : void 0 } toString() { var t = this.val % 60, e = (this.val - t) / 60; return (e < 10 ? "0" : "") + e + ":" + (t < 10 ? "0" : "") + t + "" } valueOf() { return this.toString() } add(t) { this.val += new _(t).val; return this } sub(t) { this.val -= new _(t).val; this.val < 0 && (this.val += 1440); return this } } function r(t, n) { let r = t.value; var e = async t => { if (j("#tt")) { var t = t.target, e = t.value; if (r != e) { R(r, e); await N(100); t = t.value; if (e == t) { r = t; n() } } } }; t.addEventListener("change", e, !1); t.addEventListener("keyup", e, !1) } window.makeColorSet = function () { if (d()) { let t = new h(window.__bTxtR, j("#groupchoice").value); var i = t.setList(["#FF7391", "#5CDFA7", "#878FEB", "#FE6FC5", "#768ECF", "#B49CFF", "#71BBFD", "#E7F9C0", "#7774DE", "#ADE64F", "#4AEBD7", "#F9A5C8", "#C64DB6", "#FDC010", "#88DF85", "#ACFEC9", "#8EB0E9", "#C4B96B", "#FA5BC7", "#DE8BE7", "#C152D6", "#BF9380", "#D0E39E", "#F7D30B", "#C6F6E0", "#3CF1E5", "#C2A4C8", "#ACF824", "#96F041", "#C432D6", "#BD9FA1", "#DFFAD1", "#C4EFA8", "#E244B7", "#97EDEA"], window.__codesArr.length); for (const l of O("#tt .lessonHere")) { var a = +l.getAttribute("coloridx"); let t = l.getAttribute("md5val"), e = new u, n = (e.setRGBText(i[a]), parseInt(t.substr(0, 4), 16) / 65535); e.setHSL(function (t) { t[2] = 75 + 5 * n; return t }); var o = 145 < .299 * (o = function (t) { t = t.replace("#", ""); return t = [+("0x" + (t = /^([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})$/i.exec(t))[1]), +("0x" + t[2]), +("0x" + t[3])] }(e.getRGBText()))[0] + .587 * o[1] + .114 * o[2]; l.style["background-color"] = e.getRGBText(); l.classList.add(o ? "black-text" : "white-text"); let r = function (t, e) { let n = new u, r = (n.setRGBText(e[t]), n.clone()), i = (r.setHSL(function (t) { t[1] = 35; t[2] = 25; return t }), n.clone()), a = (i.setHSL(function (t) { t[1] = 56; t[2] = 42; return t }), r), o = n, s = new Array(3).fill(0).map((t, e) => .7 * a.rgbArr[e] + .3 * o.rgbArr[e]), l = new u; l.setRGB255(s); return { D1: r, D3: i, D2x: l } }(a, i); for (const c of O(".ttr span", l)) { var s = 0 <= +c.getAttribute("dark") ? r.D2x.getRGBText() : r.D3.getRGBDText(); c.style.color = s } } } }; window.afterRender = async function () { if (d()) { let t = j("#tt"); for (const e of O("#gridtype option")) t.classList.remove(e.value); t.classList.add(j("#gridtype").value); { let t = +new Date, e = (j.style(O(".lessonHere"), { "font-size": "" }), O(".cinfo")); j.sClass(e, { "hide-ci": !0 }); await N(1); let n = e.map(t => { var e = t.closest(".lessonHere"); return [t, e, jqDim(e).outerHeight(!0)] }); n.sort((t, e) => t[2] - e[2]); for (let t = 0; t < n.length; t++)await async function (t) { t = n[t]; let e = t[0]; var r = t[1], i = t[2]; e.classList.remove("hide-ci"); await N(1); t = jqDim(r).outerHeight(!0); R("tt", e.textContent, t, i); if (t != i) { let t = .75, e = 1, n = 0; for (; .01 < e - t && n < 14;) { var a = (t + e) / 2; j.style(r, { "font-size": (100 * a).toFixed(2) + "%" }); await N(1); n++; jqDim(r).outerHeight(!0) == i ? t = a : e = a } j.style(r, { "font-size": (100 * t).toFixed(2) + "%" }) } }(t); R(new Date - t) } await 0; j(".region").classList.remove("preparing") } }; r(j("#groupchoice"), t => c(makeColorSet)); r(j("#gridtype"), t => c(afterRender)); var o = j("#groupchoice"); for (let t = 0; t < 10; t++)j.create("option", { value: "" + t, textContent: "ColorSet " + (t + 1), inside: o }); n = j("#gridtype"); j.create("option", { value: "rgrid-1", textContent: "Modern.1", inside: n }); j.create("option", { value: "rgrid-2", textContent: "RedBlock.1", inside: n }); j.create("option", { value: "colorgrid", textContent: "H-border.1", inside: n }); j.create("option", { value: "bordergrid", textContent: "Grid.1", inside: n }); let s = "AA123\tPHYSICES\t101\tLAB001\t1\t3\t14\tFri\t13:30\t14:20\t\nEF902\n\tChan Tai Man\t\nAA123\tPHYSICES\t101\tLEC001\t1\t3\t14\tFri\t14:30\t15:20\t\nEF902\n\tChan Tai Man\t\nBB123\tCHEMISTRY\t101\tLEC001\t1\t3\t14\tWed\t13:30\t16:20\t\nEF902\n\tLee Tai Man\t\nBB123\tPHYSICES\t101\tTUT001\t1\t3\t14\tWed\t8:30\t9:20\t\nEF902\n\tLee Tai Man\tRemarks\nCC123\tBIOLOGY\t101\tLEC001\t1\t3\t14\tMon\t13:30\t16:20\t\nEF902\n\tChan Tai Man\t\nCC123\tBIOLOGY\t101\tSEM001\t1\t3\t14\tMon\t16:30\t18:20\t\nEF902\n\tChan Tai Man\tRemarks"; const P = t => String.prototype.trim.call(t), l = j("#ipt"); j.set(l, { value: s, onfocus: function () { if (this.classList.contains("empty")) { this.value = ""; this.classList.toggle("empty") } }, onblur: function () { if (!this.classList.contains("empty") && "" == this.value.trim()) { this.value = s; this.classList.toggle("empty") } } }); if (window.localStorage && "string" == typeof localStorage.timeTableTxt && 0 < localStorage.timeTableTxt.length) { j.fire(l, "focus"); l.value = localStorage.timeTableTxt; l.classList.remove("empty") } function q(n) { var i, r = ["compCode", "day", "subjCode", "timeEnd", "timeStart", "venue", "weekEvery"]; let a = {}; for (let t = 0, e = n.length; t < e; t++) { const d = n[t], u = (d.weekEvery = +d.weekEvery || 1, {}); for (let t = 0, e = r.length; t < e; t++)u[r[t]] = d[r[t]]; var o = JSON.stringify(u); o in a || (a[o] = []); const f = a[o]; f.push([d.weekStart, d.weekEnd]) } const s = []; for (i in a = function (t) { const r = {}; for (var e in t) { let n = 0; var i = e.replace(/\"weekEvery\"\:(\d+)/, function (t, e) { n = +e; return "weekEvery" }); i in r || (r[i] = {}); r[i][n] = t[e] } const a = {}; for (var o in r) { let t = 0, e = ""; var n, s = r[o]; for (n in s) { e = n; t++ } if (1 == t) a[o.replace("weekEvery", '"weekEvery":' + e)] = s[e]; else { let e = {}; for (var l in s) for (var c in s[l]) for (let t = s[l][c][0]; t <= s[l][c][1]; t += +l)e[t] = 1; let n = [], r = 0; for (let t = 1; t <= 15; t++)if ((r = !r && e[t] ? t : r) && !e[t]) { var d = r, u = t - 1; n.push([d, u]); r = 0 } a[o.replace("weekEvery", '"weekEvery":1')] = n } } return a }(a)) { let r = a[i]; var l = +JSON.parse(i).weekEvery; for (let e = 1, n = r.length; e < n; e++) { let t = r[e - 1]; var c = r[e]; if (+t[1] + l == +c[0]) { t[1] = c[1]; 0; r.splice(e, 1); n--; e-- } } if (1 == l && 1 < r.length) { let n = [], t = JSON.parse(i); t.timeStart = new _(t.timeStart); t.timeEnd = new _(t.timeEnd); for (let t = 0, e = r.length; t < e; t++)r[t][0] == r[t][1] ? n.push("" + r[t][0]) : r[t][0] + 1 == r[t][1] ? n.push(r[t][0] + ", " + r[t][1]) : n.push(r[t][0] + " to " + r[t][1]); t.weekText = n.join(", "); t.weekOutput = r; s.push(t) } else for (let e = 0, t = r.length; e < t; e++) { let t = JSON.parse(i); t.timeStart = new _(t.timeStart); t.timeEnd = new _(t.timeEnd); t.weekStart = r[e][0]; t.weekEnd = r[e][1]; s.push(t) } } return s } function h(t, e) { this.txtA = t + "|" + (+e).toString(16) + "|" } h.prototype.setList = function (t, e) { this.list = t; this.maxIStrLen = (t.length - 1).toString(16).length; let n = t.length - 1; for (; (n + t.length).toString(16).length == this.maxIStrLen;)n += t.length; this.taken = n; const r = {}; let i = 0, a = 0, o = ""; const s = h.md5s; for (; a < e;) { if (o.length < this.maxIStrLen) { var l = this.txtA + (i++).toString(16); o = (s[l] = s[l] || md5(l)) + o } l = +("0x" + o.slice(-this.maxIStrLen)); if (l <= this.taken) { var c = t[l % t.length]; 0 <= r[c] || function (t, e) { for (var n in e) if (f(t, n) < 42.5475) return 1 }(c, r) || (r[c] = a++) } o = o.slice(0, -this.maxIStrLen) } let d = new Array(e); for (var u in r) d[r[u]] = u; return d }; h.prototype.takeColor = function (t) { return this.colors[t] }; h.md5s = {}; function Y(t, e) { e = +e; for (const n of t) if (1 < e) { n.style["grid-column-end"] = "span " + e; n.setAttribute("colspan", e) } else { n.style["grid-column-end"] = ""; n.removeAttribute("colspan") } } function z(t) { let e = t.style["grid-column-end"]; return e && 1 < (e = +(e = e || "").substr(5)) ? e : 1 } function tt(t, e) { return "number" == typeof t && "number" == typeof e && (t && e ? Math.abs(t * e / function (t, e) { t = Math.abs(t); e = Math.abs(e); for (; e;) { var n = e; e = t % e; t = n } return t }(t, e)) : 0) } function U(t, e) { return 0 == e ? t : t + "-" + e } function J(t, e) { if (window.localStorage) try { localStorage[t] = e } catch (t) { R(t) } } function et(t, n) { var e, r, i = t.day, a = t.th; let o = [], s = {}, l = -1; for (const k of O(`#tt div[id^="cell-${i}-"]`)) { let t = k.id.replace(`cell-${i}-`, ""), e = t.split("-"); if (!(2 < e.length)) { var c = e[0] = e[0], d = e[1] = +e[1] || 0; l = Math.max(l, d); s[c] = s[c] || []; s[c][d] = k; let t = o[d] = o[d] || {}; 0 < k.innerHTML.length ? t[c] = k.id : k.id in n ? t[c] = U(n[k.id], d) : t[c] = !1; k.classList.add(0 < Z.indexOf(i) % 2 ? "cellOdd" : "cellEven") } } l++; let u = {}; for (const L of o) for (const E of Object.keys(L).sort()) { var f = L[E]; if ("string" == typeof f) { u[E] = u[E] || { keys: {} }; u[E].keys[f] = 1 } } const h = {}; for (const T of Object.keys(u).sort()) { var p, g = u[T]; const D = []; for (let t = 0; t < l; t++)D.push({ period: T, orginalID: U("cell-" + i + "-" + T, t), idx: t, coverID: null }); for (p in g.keys) { var v = p.split("-"); D[v[3] || 0].coverID = p } for (const F of D) if (F.coverID) { h[F.coverID] = h[F.coverID] || { range0: [] }; h[F.coverID].range0.push(T) } u[T].info = D } const m = []; for (e in h) { let t = h[e]; t.range0.sort(); t.periods = {}; for (const B of t.range0) t.periods[B] = u[B].info.map(t => t.coverID); t.maxmin = function (t) { let e = (t = Object.keys(t))[0] || null, n = t[0] || null; for (const r of t) 0 < n.localeCompare(r) ? n = r : e.localeCompare(r) < 0 && (e = r); return [n, e] }(t.periods) } for (let n in h) { let e = null, t = h[n]; m.some(function (t) { if (n in t.combined) return e = t, !0 }); e || m.push(e = { combined: {}, maxmin: t.maxmin.map(t => t) }); for (var b in t.periods) for (const M of t.periods[b]) if (n && M) { e.combined[M] = 1; e.maxmin[0] = [e.maxmin[0], h[M].maxmin[0]].sort()[0]; e.maxmin[1] = (r = [e.maxmin[1], h[M].maxmin[1]]).sort()[r.length - 1] } } let w = Object.keys(u).sort(); const y = []; var x = m.reduce((t, e) => { for (var n in e.combined) { e.col = e.col || []; e.col[+n.split("-")[3] || 0] = !0 } e.colLen = e.col.filter(t => 1 == t).length; return tt(t, e.colLen) }, 1); R(x); for (const H of m) { var S = x / H.colLen, A = w.slice(w.indexOf(H.maxmin[0]), w.indexOf(H.maxmin[1]) + 1); for (const I of H.subTimePeriods = A) for (let e = 0; e < l; e++) { let t = s[I][e]; 1 != H.col[e] && t.classList.add("colspan-hidden"); Y([t], S); y.push(t) } } var C = O(`#tt div[id^="cell-${i}-"]:empty`).filter(t => !y.includes(t)); for (const j of C) { let t = j; 0 < (t.id.split("-")[3] || 0) && t.classList.add("colspan-hidden") } Y(C, x); Y(a, x); V[t.day] = x } const Z = "Mon,Tue,Wed,Thu,Fri,Sat,Sun".split(","); async function c(n) { if (!c.busy) { c.busy = !0; p(); await n(); if (!d()) return c.busy = !1, void 0; J("gridtype", j("#gridtype").value); await N(1); window.scaler = new v(j(".adaptive-inner"), j(".adaptive-outer")); window.scaler.scalePages(); if (!a) return c.busy = !1, void 0; j(".imgdl").classList.add("disablebtn"); n = j(".imgdl").innerHTML; let e = 0, t = j.create("span", { style: { float: "right", position: "absolute" }, inside: j(".imgdl") }); var r = () => { 0 <= e && (t.innerHTML = [".  ", ".. ", "...", ".. "][e++ % 4]) }, i = setInterval(r, 138); r(); for (; await N(33), j(".preparing");); r = await async function (t) { var e = j("#hiddenDraw"); j.clearContent(e); j.style(e, { position: "fixed", float: "left", display: "inline-block", width: "1200px", height: "1200px" }); let n = j("#tt"), r = n.cloneNode(!0), i = (j.set(r, { sAttr: { id: !1 }, sClass: { ttw: !0 } }), jqDim(n).outerWidth(!0)), a = jqDim(n).outerHeight(!0), o = function (t, e, n, r) { let i = e, a = t, o = (n * a + r * i) / (a * a + i * i), s = (o = +o.toFixed(2), i * o), l = a * o; return [o, l, s] }(i, a, 1024, 1024), s = (j.set(r, { style: { position: "fixed", left: "-9999px", top: "-9999px" }, inside: e }), await html2canvas(r, { windowWidth: 1920, windowHeight: 1080, imageTimeout: 1, scale: o[0] })); s.imageSmoothingEnabled = !1; s.mozImageSmoothingEnabled = !1; s.webkitImageSmoothingEnabled = !1; return "blob" == t ? (e = await new Promise(t => s.toBlob(t)), { url: URL.createObjectURL(e), success: !0 }) : (t = "base64", { url: s.toDataURL(), success: !0 }) }("blob"); if (r.success) { r = r.url; let t = j(".imgdl"); j.set(t, { attributes: { href: r, target: "", download: `polyu-timetablebuilder-${Date.now()}.png` }, sClass: { disablebtn: !1 } }); e = -1; clearInterval(i); t.innerHTML = n } c.busy = !1 } } function K() { const t = j(".region #tt"); let n = 0, r = "minmax(98px,auto)"; for (let e = 0; e < Q + 1; e++) { var i = V[Z[e]] || 1; n += i; let t = 999; for (const s of O(`.box.lessonHere[id^="cell-${Z[e]}"]`)) { var a = z(s); a < t && (t = a) } var o = 9 / (t = 999 == t ? 1 : t); r += " repeat(" + i + ", minmax(" + o + "em,min-content))" } t.style["grid-template-columns"] = r } let Q = null; const V = {}; async function b() {
        let t = j(".region"); t.classList.add("preparing"); j.clearContent(t); j.set(t, { inside: j("center", O(".tab")[1]) }); J("gridtype", j("#gridtype").value); j(".imgdl").classList.add("disablebtn"); let e = j("#tt"); if (e) { e.remove(); j.clearContent(e) } var n = function (t) { t = (t = (t = t.replace(/\r\n|\n\r/g, "\n")).replace(/\r/g, "\n")).trim(); for (var e; e = /^[a-zA-Z\s\(\)]+\n/.exec(t);)t = t.substr(e[0].length).trim(); var n = t = t.trim(); let r = (t.match(/[^\r\n\t]+(\t[^\r\n\t]*){5,10}([\r\n]+[^\r\n\t]+)+/g) || []).map(t => t.replace(/\t([\r\n]+)/g, "$1")), a = []; for (let t = 0, e = (r = r.map(t => t.split(/\t|[\r\n]+\s*/))).length; t < e; t++) { let e = r[t]; for (let t = e.length; t < 13; t++)e[t] = ""; if (13 != e.length) { R(e); console.warn("txtAnalysis: Invalid Format") } const o = {}; o.subjCode = P(e[0]); o.title = P(e[1]); o.group = P(e[2]); o.compCode = P(e[3]); o.weekEvery = +P(e[4]); o.weekStart = +P(e[5]); o.weekEnd = +P(e[6]); o.day = P(e[7]); if (0 == P(e[8]).length || 0 == P(e[9]).length) R("skipped", o); else { o.timeStart = new _(P(e[8])); o.timeEnd = new _(P(e[9])); o.venue = P(e[10]); let n = o.venue.split(/\s*,\s*/), r = (n.push(""), -1), i = ""; for (let e = 0; e < n.length; e++) { let t = n[e]; if (t != i) { if (0 <= r && r + 2 <= e - 1) { n[r] = n[r] + "-" + n[e - 1]; n.splice(r + 1, e - r); e = r } r = e } (i = t.replace(/\d+$/, function (t) { return +t + 1 })) == t && (i = "") } n.length--; o.venue = n.join(", "); ((e = P(e[11]).split(/\s*\t\s*/)).length < 1 || 2 < e.length) && console.warn("txtAnalysis: Invalid Format"); o.teachingStaff = P(e[0]); 2 == e.length && (o.remark = P(e[1])); a.push(o) } } return [a, n] }(j("#ipt").value); let d = q(n[0]); var r = (d = d.filter(t => { t.dayIndexOf = Z.indexOf(t.day); return 0 <= t.dayIndexOf })).map(t => t.dayIndexOf); (Q = 0 <= (Q = Math.max.apply(Math, r)) && Q <= 4 ? 4 : 5 == Q ? 5 : 6 == Q ? 6 : Z.length - 1) >= Z.length && (Q = Z.length - 1); let i = n[1]; { var a = d, o, r = a.length; let t, e; for (t = r - 1; 0 < t; t--)for (e = 0; e < t; e++)if (a[e].weekStart > a[e + 1].weekStart) { o = a[e]; a[e] = a[e + 1]; a[e + 1] = o } } let s = {}, l = []; for (let t = 0; t < d.length; t++) { var c = d[t].subjCode + ""; s[c] || (s[c] = l.push(c)) } window.__codesArr = l; window.__codes = s; let u = new Array(Q + 1); for (let t = Q + 1; t--;)u[t] = '<div class="box hbox">' + Z[t] + "</div>"; j(".region").innerHTML = '<div id="tt" class="wrapper ttc"><div class="box ebox"></div>' + u.join("") + "</div>"; K(); X(1); window.chWeekNoButStatus(); window.__bTxtR = md5(i.replace(/[\s\t\r\n:]+/g, "")); let f = new _("8:30"), h = new _("18:20"); for (let e = 0; e < d.length; e++) { let t = d[e].timeEnd; h.cmp(t) < 0 && (h = new _(t)); t = null } 30 == f.getMin() && f.sub("0:30"); 20 == h.getMin() && h.add("0:30"); let p = f, g = ""; for (; ;) { let t = new _(p).add("0:20"); if (0 < t.cmp(h)) break; const F = []; for (let t = 0; t <= Q; t++)F.push('<div class="box bbox" id="cell-' + Z[t] + "-" + (p + "").replace(":", "") + '"></div>'); F.unshift('<div class="box tbox"><div><span>' + p + " - " + t + "</span></div></div>"); g += F.join(""); p.add("0:30") } j("#tt").innerHTML += g; n = d.map(t => [t.weekStart, t.weekEnd]), r = [].concat.apply([], n).filter(t => 0 < t); let v = Math.max.apply(Math, r), m = Math.min.apply(Math, r); if (m <= 20 && v <= 20 && 0 < m && 0 < v) { m = ~~m; v = ~~v } else { m = 1; v = 13 } let b = {}, w = 0; for (let t = 0; t < d.length; t++) {
          let e = d[t], n = function (t, e) { let n = new _(t), r = []; for (; n.cmp(e) < 0;) { r.push(n + ""); n.add("0:30") } return r }(e.timeStart, e.timeEnd); var y = "cell-" + e.day + "-" + n[0].replace(":", ""), x = O("#tt .hbox").filter(t => t.textContent.trim() == e.day); let r = z(x[0]), i = (V[e.day] = r, !0), a, o; for (let t = 1; t <= r; t++)if (function (n, r, i, a) { for (let t = 0, e = r.length; t < e; t++) { var o = `cell-${n}-` + r[t].replace(":", ""), s = j("#" + U(o, i - 1)); if (0 < ((s ? s.innerHTML : "") || "").length || o in a) return } return 1 }(e.day, n, t, b)) { a = U("", t - 1); o = j("#" + y + a); i = !1; break } if (1 == i) { w++; V[e.day] = ++r; Y(x, V[e.day]); for (const M of O(`#tt div[id^="cell-${e.day}-"]`)) { let t = M.id; 3 == t.split("-").length && j.create("div", { className: "supplementCell box bbox", attributes: { id: U(t, r - 1) }, after: j("#" + U(t, r - 2)) }) } a = "-" + (r - 1); o = j("#" + y + a) } j.set(o, { attributes: { rowspan: n.length }, style: { "grid-row-end": "span " + n.length } }); for (let t = 1; t < n.length; t++) { var S = "cell-" + e.day + "-" + n[t].replace(":", "") + a; j("#" + S).classList.add("rowspan-hidden"); b[S] = y } o.classList.add("lessonHere"); j.set(o, { attributes: { coloridx: "" + (window.__codes[e.subjCode] - 1), md5val: md5(e.venue) } }); var x = j.create("div", {
            className: "wrapper innerwrap", innerHTML: `
                <div class="ttr ttr1"></div>
                <div class="cinfo"></div>
                <div class="ttr ttr2"></div>
                `, inside: o
          }), A = m + Math.floor((v - m) / 2); const B = {}; let s = 0, l = 0, c = 0; for (let t = m; t <= v; t++) { B[t] = [0, t > A, t > A ? l : s, c++]; B[t][1] ? l++ : s++ } j.set(O(".ttr1", x), { innerHTML: new Array(A - m + 1).fill(0).map(t => "<span></span>").join("") }); j.set(O(".ttr2", x), { innerHTML: new Array(v - (A + 1) + 1).fill(0).map(t => "<span></span>").join("") }); var C, k = O(".ttr span", x); if ("string" == typeof e.weekText) for (const H of e.weekOutput) for (let t = H[0]; t <= H[1]; t++)t in B && (B[t][0] = 1); else { var L = 1 < e.weekEvery ? e.weekEvery : 1; for (let t = e.weekStart; t <= e.weekEnd; t += L)t in B && (B[t][0] = 1) } for (C in B) { var E = +C, T = 0 < +B[E][0]; let t = k[B[E][3]]; t.innerHTML = (T ? G : W)[E - 1]; t.setAttribute("dark", T ? "1" : "0"); t.setAttribute("wn", E) } j.create("span", { textContent: e.subjCode + " " + e.compCode + " " + e.venue, inside: j("div.cinfo", x) })
        } let D = O("#tt .hbox"); for (const I of Z.map(e => ({ day: e, th: D.filter(t => t.textContent.trim() == e) }))) et(I, b); K(); window.makeColorSet(); window.localStorage && !j("#ipt").classList.contains("empty") && J("timeTableTxt", i); await N(1); await window.afterRender()
      } function p() { let t = j(".imgdl"); t.removeAttribute("download"); t.removeAttribute("target"); t.removeAttribute("href") } function X(t) { R("ts", t); 0 == t && j(".imgdl").classList.add("disablebtn"); j(".imgdl").classList.contains("disablebtn") && p(); j.sClass(O(".tabbut"), { selected: !1 })[t].classList.add("selected"); j.sClass(O(".tab"), { selected: !1 })[t].classList.add("selected") } async function g(t) { switch (t) { case 0: X(t); await N(1); j.clearContent(j(".region")); break; case 1: c(b); break; default: return }J("tabIdxSave", +t) } j("#but_input").addEventListener("click", function () { g(0) }, !1); j("#but_output").addEventListener("click", function () { g(1) }, !1); window.chWeekNoButStatus = function () { j("#tt").setAttribute("weekNo", j("#optWeekNo").getAttribute("butStatus")) }; j("#optWeekNo").addEventListener("click", function () { let e = this; new Promise(t => { if ("N" == e.getAttribute("butStatus")) { e.setAttribute("butStatus", "Y"); J("optWeekNo", "Y") } else { e.setAttribute("butStatus", "N"); J("optWeekNo", "N") } window.chWeekNoButStatus(); c(afterRender) }) }, !1); j.ready().then(function () { localStorage.gridtype && (j("#gridtype").value = localStorage.gridtype); j("#optWeekNo").setAttribute("butStatus", "N" == localStorage.optWeekNo ? "N" : "Y"); g(0 <= +localStorage.tabIdxSave ? +localStorage.tabIdxSave : 0) }); function v(t, e) { this.elmInner = t; this.elmOuter = e; this.bHeight = jqDim(t).height(); this.bWidth = jqDim(t).width() } function m(t, e) { return +t.toFixed(e) } v.prototype.scalePages = function () { var t = jqDim(this.elmOuter).height(), e = jqDim(this.elmOuter).width(), n = e / this.bWidth, r = t / this.bHeight, r = m(r < n ? r : n, 3), n = Math.abs(m(.5 * (this.bWidth - e / r), 3)); Math.abs(m(.5 * (this.bHeight - t / r), 3)); j.set(this.elmInner, { attributes: { _scale: r }, style: { transform: "scale(" + r + ") translate(" + n + "px, 0px)" } }) }; window.scaler = !1; window.addEventListener("resize", function () { window.scaler && window.scaler.scalePages() }, !1)
    }();
</script>

</html>